<div class="patient-management">
  <div class="header">
    <h1>Patient Management</h1>
    <button class="btn btn-primary" (click)="toggleForm()">
      {{ showForm ? 'Cancel' : 'Add New Patient' }}
    </button>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Patient Form -->
  <div *ngIf="showForm" class="patient-form-container">
    <h2>Create New Patient</h2>
    <form [formGroup]="patientForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">First Name *</label>
          <input 
            type="text" 
            id="firstName" 
            formControlName="firstName"
            [class.error]="patientForm.get('firstName')?.invalid && patientForm.get('firstName')?.touched"
          />
          <span class="error-message" *ngIf="patientForm.get('firstName')?.invalid && patientForm.get('firstName')?.touched">
            {{ getErrorMessage('firstName') }}
          </span>
        </div>

        <div class="form-group">
          <label for="lastName">Last Name *</label>
          <input 
            type="text" 
            id="lastName" 
            formControlName="lastName"
            [class.error]="patientForm.get('lastName')?.invalid && patientForm.get('lastName')?.touched"
          />
          <span class="error-message" *ngIf="patientForm.get('lastName')?.invalid && patientForm.get('lastName')?.touched">
            {{ getErrorMessage('lastName') }}
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email">Email</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email"
            [class.error]="patientForm.get('email')?.invalid && patientForm.get('email')?.touched"
          />
          <span class="error-message" *ngIf="patientForm.get('email')?.invalid && patientForm.get('email')?.touched">
            {{ getErrorMessage('email') }}
          </span>
        </div>

        <div class="form-group">
          <label for="phone">Phone *</label>
          <input 
            type="tel" 
            id="phone" 
            formControlName="phone"
            placeholder="(555) 123-4567"
            [class.error]="patientForm.get('phone')?.invalid && patientForm.get('phone')?.touched"
          />
          <span class="error-message" *ngIf="patientForm.get('phone')?.invalid && patientForm.get('phone')?.touched">
            {{ getErrorMessage('phone') }}
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="dateOfBirth">Date of Birth *</label>
          <input 
            type="date" 
            id="dateOfBirth" 
            formControlName="dateOfBirth"
            [class.error]="patientForm.get('dateOfBirth')?.invalid && patientForm.get('dateOfBirth')?.touched"
          />
          <span class="error-message" *ngIf="patientForm.get('dateOfBirth')?.invalid && patientForm.get('dateOfBirth')?.touched">
            {{ getErrorMessage('dateOfBirth') }}
          </span>
        </div>

        <div class="form-group">
          <label for="address">Address</label>
          <input type="text" id="address" formControlName="address" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="emergencyContactName">Emergency Contact Name</label>
          <input type="text" id="emergencyContactName" formControlName="emergencyContactName" />
        </div>

        <div class="form-group">
          <label for="emergencyContactPhone">Emergency Contact Phone</label>
          <input 
            type="tel" 
            id="emergencyContactPhone" 
            formControlName="emergencyContactPhone"
            placeholder="(555) 123-4567"
            [class.error]="patientForm.get('emergencyContactPhone')?.invalid && patientForm.get('emergencyContactPhone')?.touched"
          />
          <span class="error-message" *ngIf="patientForm.get('emergencyContactPhone')?.invalid && patientForm.get('emergencyContactPhone')?.touched">
            {{ getErrorMessage('emergencyContactPhone') }}
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="insuranceProvider">Insurance Provider</label>
          <input type="text" id="insuranceProvider" formControlName="insuranceProvider" />
        </div>

        <div class="form-group">
          <label for="insurancePolicyNumber">Insurance Policy Number</label>
          <input type="text" id="insurancePolicyNumber" formControlName="insurancePolicyNumber" />
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="isLoading">
          {{ isLoading ? 'Creating...' : 'Create Patient' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="toggleForm()">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Patients List -->
  <div class="patients-list">
    <h2>Patients</h2>
    <div *ngIf="isLoading" class="loading">Loading patients...</div>
    
    <div *ngIf="!isLoading && patients.length === 0" class="no-data">
      No patients found. Add a new patient to get started.
    </div>

    <table *ngIf="!isLoading && patients.length > 0">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Date of Birth</th>
          <th>Insurance</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let patient of patients">
          <td>{{ patient.firstName }} {{ patient.lastName }}</td>
          <td>{{ patient.email || 'N/A' }}</td>
          <td>{{ patient.phone }}</td>
          <td>{{ patient.dateOfBirth | date:'MM/dd/yyyy' }}</td>
          <td>{{ patient.insuranceProvider || 'N/A' }}</td>
          <td>
            <span [class.active]="patient.isActive" [class.inactive]="!patient.isActive">
              {{ patient.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
